title: 自调用的方式
date: 2013-11-18 15:40:10
categories: [JavaScript]
tags: [JavaScript]
---
平时我们可能对添加括号来调用匿名函数的方式更为习惯:

```javascript
(function(){alert('iifksp')})() // undefinded
// 另外一种, 主要是括号的位置不同
(function(){alert('iifksp')}()) // undefinded
```
<!--more-->

## 感叹号开头的自调用
其实很多库中都是这么去写的：

```javascript
!function(){alert('iifksp')}()        // true
```

其实无论是括号，还是感叹号，让整个语句合法做的事情只有一件，就是让一个函数声明语句变成了一个表达式。任何消除函数声明和函数表达式间歧义的方法，都可以被解析器正确识别。比如：

```
var i = function(){return 10}();        // undefined
1 && function(){return true}();        // true
1, function(){alert('iifksp')}();        // undefined
```

赋值，逻辑，甚至是逗号，各种操作符都可以告诉解析器，这个不是函数声明，它是个函数表达式。并且，对函数一元运算可以算的上是消除歧义最快的方式，感叹号只是其中之一，如果不在乎返回值，这些一元运算都是有效的：

```
!function(){alert('iifksp')}()        // true
+function(){alert('iifksp')}()        // NaN
-function(){alert('iifksp')}()        // NaN
~function(){alert('iifksp')}()        // -1
```

## 效率问题
不同的写法，同样的效果，当然会让人想到是否会影响效率。所以有人进行了一些测试:http://jsperf.com/js-funcion-expression-speed。结果显示，效率较快的是: 括号，感叹号，加减号。

可是为什么很多库会选择感叹号，应该是一种习惯，当然视觉上也比括号更有优势。

## 总结
自调用的方式，简单的写的话，可以使用!,+,-符号，规范一点的写法就用括号形式。

## 参考资料
- [function与感叹号](http://www.swordair.com/blog/2011/10/714/)